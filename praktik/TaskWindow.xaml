<Window x:Class="praktik.TaskWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:praktik"
        mc:Ignorable="d"
        Title="Задача" Height="600" Width="700" WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TabControl Grid.Row="0" Margin="10">
            <TabItem Header="Основная информация">
                <ScrollViewer>
                    <StackPanel Margin="10">
                        <TextBlock Text="Название:" Margin="0,10,0,5"/>
                        <TextBox x:Name="txtTitle" Margin="0,0,0,10"/>

                        <TextBlock Text="Описание:" Margin="0,0,0,5"/>
                        <TextBox x:Name="txtDescription" Margin="0,0,0,10" Height="60" TextWrapping="Wrap" AcceptsReturn="True"/>

                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Дата начала:" Margin="0,0,0,5"/>
                                <DatePicker x:Name="dpStartDate"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                <TextBlock Text="Дата окончания:" Margin="0,0,0,5"/>
                                <DatePicker x:Name="dpEndDate"/>
                            </StackPanel>
                        </Grid>

                        <Grid Margin="0,0,0,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Объект:" Margin="0,0,0,5"/>
                                <ComboBox x:Name="cbSites" DisplayMemberPath="SiteName"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Margin="10,0,0,0">
                                <TextBlock Text="Бригада:" Margin="0,0,0,5"/>
                                <ComboBox x:Name="cbCrews" DisplayMemberPath="CrewName"/>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Margin="10,0,0,0">
                                <TextBlock Text="Приоритет:" Margin="0,0,0,5"/>
                                <ComboBox x:Name="cbPriorities" DisplayMemberPath="PriorityName"/>
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="Материалы">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border x:Name="borderAwaitMTS" Grid.Row="0" Background="#FDD835" 
                           Padding="8" Margin="0,0,0,10" CornerRadius="4" Visibility="Collapsed">
                        <TextBlock Text="⏳ Ожидание МТС" FontWeight="Bold" HorizontalAlignment="Center"/>
                    </Border>

                    <DataGrid x:Name="dgMaterialRequests" Grid.Row="1" 
                             AutoGenerateColumns="False" IsReadOnly="True" 
                             SelectionChanged="dgMaterialRequests_SelectionChanged" Margin="0,0,0,10">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Статус" Binding="{Binding StatusDisplay}" Width="120"/>
                            <DataGridTextColumn Header="Требуется к" Binding="{Binding RequiredDateDisplay}" Width="120"/>
                            <DataGridTextColumn Header="Создана" Binding="{Binding CreatedAtDisplay}" Width="130"/>
                            <DataGridTextColumn Header="Позиций" Binding="{Binding ItemsCount}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button x:Name="btnNewRequest" Content="Новая заявка" 
                               Click="btnNewRequest_Click" Margin="0,0,8,0" Width="120"/>
                        <Button x:Name="btnEditRequest" Content="Редактировать" 
                               Click="btnEditRequest_Click" Margin="0,0,8,0" Width="120"/>
                        <Button x:Name="btnViewRequestHistory" Content="История" 
                               Click="btnViewRequestHistory_Click" Width="100"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <TabItem Header="События" x:Name="tabEvents">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="0,0,0,10" Margin="0,0,0,10">
                        <StackPanel>
                            <TextBlock Text="Последние события" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,10"/>
                            
                            <Border BorderBrush="#E0E0E0" 
                                    BorderThickness="1" 
                                    CornerRadius="4"
                                    Padding="10"
                                    Background="#F5F5F5"
                                    Margin="0,0,0,10">
                                <StackPanel>
                                    <TextBlock Text="Добавить комментарий" 
                                               FontSize="12" 
                                               FontWeight="SemiBold"
                                               Foreground="#424242"
                                               Margin="0,0,0,8"/>
                                    <TextBox x:Name="txtEventComment"
                                             TextWrapping="Wrap"
                                             AcceptsReturn="True"
                                             FontSize="12"
                                             Background="White"
                                             BorderBrush="#E0E0E0"
                                             Padding="8"
                                             MinHeight="50"
                                             MaxHeight="100"
                                             VerticalScrollBarVisibility="Auto"
                                             Margin="0,0,0,8"/>
                                    <Button Content="Добавить" 
                                            x:Name="btnAddEventComment"
                                            Click="btnAddEventComment_Click"
                                            Width="100" 
                                            Height="32"
                                            HorizontalAlignment="Left"
                                            Padding="8,0"
                                            FontSize="12"/>
                                </StackPanel>
                            </Border>
                            
                            <StackPanel x:Name="pnlQuickNote" Orientation="Horizontal" Visibility="Collapsed" Margin="0,5,0,0">
                                <TextBox x:Name="txtQuickNote" 
                                        Width="350" 
                                        Height="32" 
                                        Margin="0,0,10,0"
                                        TextChanged="txtQuickNote_TextChanged"
                                        KeyDown="txtQuickNote_KeyDown"
                                        VerticalContentAlignment="Center"
                                        FontSize="13"
                                        Padding="8,0">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox">
                                            <Setter Property="ToolTip" Value="Короткая пометка…"/>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>
                                <Button x:Name="btnSaveNote" 
                                       Content="Сохранить" 
                                       Click="btnSaveNote_Click" 
                                       Width="100" 
                                       Height="32"
                                       Margin="0,0,8,0"
                                       IsEnabled="False"
                                       Padding="8,0"
                                       FontSize="13"/>
                                <Button x:Name="btnCancelNote" 
                                       Content="Отмена" 
                                       Click="btnCancelNote_Click" 
                                       Width="90" 
                                       Height="32"
                                       Padding="8,0"
                                       FontSize="13"/>
                            </StackPanel>
                            <Button x:Name="btnAddQuickNote" 
                                   Content="+ заметка" 
                                   Click="btnAddQuickNote_Click" 
                                   MinWidth="130" 
                                   Padding="10,0"
                                   Height="30"
                                   HorizontalAlignment="Left"
                                   Visibility="Collapsed"/>
                        </StackPanel>
                    </Border>

                    <ListBox x:Name="lbEvents" Grid.Row="1" 
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                            BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="0,8,0,8" Margin="0,0,0,5">
                                    <StackPanel>
                                        <TextBlock Text="{Binding DisplayText}" TextWrapping="Wrap" FontSize="13"/>
                                        <TextBlock Text="{Binding TimeInfo}" FontSize="11" Foreground="#666666" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>
            </TabItem>
        </TabControl>

        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10">
            <Button x:Name="btnPrint" Content="Печать" Click="btnPrint_Click" Width="100" Margin="0,0,20,0" Visibility="Collapsed"/>
            <Button x:Name="btnSave" Content="Сохранить" Click="btnSave_Click" Width="100" Margin="0,0,20,0"/>
            <Button x:Name="btnCancel" Content="Отмена" Click="btnCancel_Click" Width="100"/>
        </StackPanel>
    </Grid>
</Window>
