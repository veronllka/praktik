<Window x:Class="praktik.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:praktik"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="Планировщик работ бригад" Height="800" Width="1400" WindowState="Maximized"
        Background="{DynamicResource MaterialDesignPaper}">
    <materialDesign:DrawerHost IsLeftDrawerOpen="{Binding ElementName=MenuToggleButton, Path=IsChecked}"
                      IsRightDrawerOpen="{Binding ElementName=HelpButton, Path=IsChecked}">
        <!-- Левое меню -->
        <!-- Правое меню с помощью -->
        <materialDesign:DrawerHost.RightDrawerContent>
            <DockPanel Width="350" Margin="16">
                <TextBlock Text="Справка по функциям" Style="{StaticResource HeaderTextStyle}" DockPanel.Dock="Top"/>
                <Button x:Name="btnCloseHelp" Content="ЗАКРЫТЬ" 
                      Click="btnCloseHelp_Click"
                      Style="{StaticResource MaterialDesignRaisedButton}"
                      Margin="0,16,0,0"
                      DockPanel.Dock="Bottom"/>
                <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="0,16,0,16">
                    <StackPanel x:Name="HelpContent">
                        <Expander x:Name="HelpHomeExpander" Header="Главная" IsExpanded="False" Margin="0,0,0,8">
                            <TextBlock TextWrapping="Wrap">
                                Главная страница приложения, показывающая общую статистику:<LineBreak/>
                                • Общее количество задач<LineBreak/>
                                • Количество завершенных задач<LineBreak/>
                                • Количество просроченных задач<LineBreak/>
                                • Количество активных бригад<LineBreak/>
                                • Последние отчеты по задачам
                            </TextBlock>
                        </Expander>
                        
                        <Expander x:Name="HelpSitesExpander" Header="Стройплощадки" IsExpanded="False" Margin="0,0,0,8">
                            <TextBlock TextWrapping="Wrap">
                                Управление объектами строительства:<LineBreak/>
                                • Просмотр списка стройплощадок<LineBreak/>
                                • Добавление новых объектов<LineBreak/>
                                • Редактирование существующих объектов<LineBreak/>
                                • Удаление объектов
                            </TextBlock>
                        </Expander>
                        
                        <Expander x:Name="HelpCrewsExpander" Header="Бригады" IsExpanded="False" Margin="0,0,0,8">
                            <TextBlock TextWrapping="Wrap">
                                Управление строительными бригадами:<LineBreak/>
                                • Просмотр списка бригад<LineBreak/>
                                • Добавление новых бригад<LineBreak/>
                                • Назначение бригадира<LineBreak/>
                                • Редактирование информации о бригаде<LineBreak/>
                                • Удаление бригады
                            </TextBlock>
                        </Expander>
                        
                        <Expander x:Name="HelpTasksExpander" Header="Задачи" IsExpanded="False" Margin="0,0,0,8">
                            <TextBlock TextWrapping="Wrap">
                                Управление задачами для бригад:<LineBreak/>
                                • Просмотр списка всех задач<LineBreak/>
                                • Фильтрация задач по объекту и бригаде<LineBreak/>
                                • Добавление новых задач<LineBreak/>
                                • Редактирование задач<LineBreak/>
                                • Изменение статуса задачи<LineBreak/>
                                • Удаление задач<LineBreak/><LineBreak/>
                                
                                Кнопка "Сбросить фильтр" очищает все примененные фильтры и показывает все задачи.
                            </TextBlock>
                        </Expander>
                        
                        <Expander x:Name="HelpCalendarExpander" Header="Календарь" IsExpanded="False" Margin="0,0,0,8">
                            <TextBlock TextWrapping="Wrap">
                                Календарный вид задач:<LineBreak/>
                                • Выбор даты для просмотра задач<LineBreak/>
                                • Фильтрация задач по объекту и бригаде<LineBreak/>
                                • Просмотр задач на выбранную дату<LineBreak/>
                                • Визуальное представление графика работ
                            </TextBlock>
                        </Expander>
                        
                        <Expander x:Name="HelpReportsExpander" Header="Отчеты" IsExpanded="False" Margin="0,0,0,8">
                            <TextBlock TextWrapping="Wrap">
                                Формирование и экспорт отчетов:<LineBreak/>
                                • Отчет "Задачи по объектам" - статистика задач в разрезе объектов<LineBreak/>
                                • Отчет "Выполнение по бригадам" - статистика выполнения задач бригадами<LineBreak/>
                                • Отчет "Просроченные задачи" - список просроченных задач<LineBreak/><LineBreak/>
                                
                                Экспорт отчетов:<LineBreak/>
                                • CSV - экспорт в формате с разделителями для Excel<LineBreak/>
                                • Excel - экспорт в табличный формат<LineBreak/>
                                • PDF - экспорт в текстовый формат<LineBreak/><LineBreak/>
                                
                                При экспорте сохраняется текущий выбранный тип отчета.
                            </TextBlock>
                        </Expander>
                        
                        <Expander x:Name="HelpJournalExpander" Header="Журнал" IsExpanded="False" Margin="0,0,0,8">
                            <TextBlock TextWrapping="Wrap">
                                Журнал отчетов и комментариев по задачам:<LineBreak/>
                                • Просмотр всех комментариев и отчетов<LineBreak/>
                                • Отслеживание изменений статусов задач<LineBreak/>
                                • История работы с задачами
                            </TextBlock>
                        </Expander>
                    </StackPanel>
                </ScrollViewer>
            </DockPanel>
        </materialDesign:DrawerHost.RightDrawerContent>
        
        <!-- Левое меню -->
        <materialDesign:DrawerHost.LeftDrawerContent>
            <DockPanel MinWidth="220">
                <!-- Современная анимированная декорация в меню -->
                <Grid DockPanel.Dock="Bottom" Height="250">
                    <!-- Фон сцены -->
                    <Rectangle Fill="#F5F7FA" Width="220" Height="250"/>
                    
                    <!-- Здание -->
                    <Border Width="120" Height="160" Background="#E1F5FE" BorderBrush="#B3E5FC" BorderThickness="1" 
                           CornerRadius="2,2,0,0" HorizontalAlignment="Center" VerticalAlignment="Bottom">
    <Grid>
                            <!-- Окна здания (статические) -->
                            <UniformGrid Rows="4" Columns="2" Margin="10">
                                <Border Margin="5" Background="#1976D2" CornerRadius="2"/>
                                <Border Margin="5" Background="#64B5F6" CornerRadius="2"/>
                                <Border Margin="5" Background="#64B5F6" CornerRadius="2"/>
                                <Border Margin="5" Background="#1976D2" CornerRadius="2"/>
                                <Border Margin="5" Background="#1976D2" CornerRadius="2"/>
                                <Border Margin="5" Background="#64B5F6" CornerRadius="2"/>
                                <Border Margin="5" Background="#64B5F6" CornerRadius="2"/>
                                <Border Margin="5" Background="#1976D2" CornerRadius="2"/>
                            </UniformGrid>
                        </Grid>
                    </Border>
                    
                    <!-- Солнце -->
                    <Ellipse Width="40" Height="40" Fill="#FFEB3B" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="20,20,0,0"/>
                    
                    <!-- Земля -->
                    <Rectangle Fill="#8BC34A" Height="30" VerticalAlignment="Bottom" Width="220"/>
                </Grid>
                
                <ToggleButton Style="{StaticResource MaterialDesignHamburgerToggleButton}" 
                            DockPanel.Dock="Top"
                            HorizontalAlignment="Right" Margin="16"
                            IsChecked="{Binding ElementName=MenuToggleButton, Path=IsChecked, Mode=TwoWay}" />
                
                <ListBox x:Name="NavigationListBox" SelectionChanged="NavigationListBox_SelectionChanged" Margin="0,16,0,16">
                    <ListBoxItem>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="ViewDashboard" Width="24" Height="24" VerticalAlignment="Center"/>
                            <TextBlock Text="Главная" Margin="16,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </ListBoxItem>
                    <ListBoxItem>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Domain" Width="24" Height="24" VerticalAlignment="Center"/>
                            <TextBlock Text="Стройплощадки" Margin="16,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </ListBoxItem>
                    <ListBoxItem>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="AccountGroup" Width="24" Height="24" VerticalAlignment="Center"/>
                            <TextBlock Text="Бригады" Margin="16,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </ListBoxItem>
                    <ListBoxItem>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="ClipboardList" Width="24" Height="24" VerticalAlignment="Center"/>
                            <TextBlock Text="Задачи" Margin="16,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </ListBoxItem>
                    <ListBoxItem>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Calendar" Width="24" Height="24" VerticalAlignment="Center"/>
                            <TextBlock Text="Календарь" Margin="16,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </ListBoxItem>
                    <ListBoxItem>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="FileDocument" Width="24" Height="24" VerticalAlignment="Center"/>
                            <TextBlock Text="Отчёты" Margin="16,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </ListBoxItem>
                    <ListBoxItem>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="MessageText" Width="24" Height="24" VerticalAlignment="Center"/>
                            <TextBlock Text="Журнал" Margin="16,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </ListBoxItem>
                    <ListBoxItem x:Name="MaterialRequestsMenuItem">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="PackageVariant" Width="24" Height="24" VerticalAlignment="Center"/>
                            <TextBlock Text="Заявки на материалы" Margin="16,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </ListBoxItem>
                </ListBox>
            </DockPanel>
        </materialDesign:DrawerHost.LeftDrawerContent>

        <!-- Основной контент -->
        <DockPanel>
            <!-- Верхняя панель -->
            <materialDesign:ColorZone Padding="16" materialDesign:ElevationAssist.Elevation="Dp4"
                                    Mode="PrimaryMid" DockPanel.Dock="Top">
                <DockPanel>
                    <ToggleButton x:Name="MenuToggleButton"
                                Style="{StaticResource MaterialDesignHamburgerToggleButton}" />
                    
                    <TextBlock x:Name="PageTitle" Text="Главная" 
                             Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                             VerticalAlignment="Center" Margin="16,0"/>
                             
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <!-- Информация о пользователе и кнопка выхода рядом с ролью -->
                        <Border Background="#7B1FA2" CornerRadius="4" Margin="0,0,16,0" Padding="8,4">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Account" VerticalAlignment="Center" Margin="0,0,8,0" Foreground="White"/>
                                <TextBlock x:Name="UserInfo" Text="Загрузка..." 
                                         VerticalAlignment="Center" Foreground="White" Margin="0,0,8,0"/>
                                <Button x:Name="LogoutBtn" 
                                      Style="{StaticResource MaterialDesignFlatButton}"
                                      Height="24" Padding="4,0"
                                      ToolTip="Выйти из аккаунта"
                                      Foreground="White">
                                    <materialDesign:PackIcon Kind="Logout" />
                                </Button>
                            </StackPanel>
                        </Border>
                        
                        <ToggleButton x:Name="HelpButton" 
                                    Style="{StaticResource MaterialDesignActionToggleButton}"
                                    ToolTip="Справка по функциям"
                                    Margin="0,0,16,0">
                            <materialDesign:PackIcon Kind="HelpCircleOutline" />
                        </ToggleButton>
                        <Button Content="ЗАКРЫТЬ" Click="MenuExit_Click" 
                              Style="{StaticResource MaterialDesignOutlinedButton}"/>
                    </StackPanel>
                </DockPanel>
            </materialDesign:ColorZone>

            <!-- Контент страниц -->
            <Grid x:Name="MainContent">
                <!-- Главная -->
                <Grid x:Name="DashboardContent" Visibility="Visible">
                    <ScrollViewer>
                        <StackPanel Margin="24">
                            <TextBlock Text="Обзор системы" Style="{StaticResource HeaderTextStyle}"/>
                            
                            <UniformGrid Columns="4" Margin="0,16">
                                <materialDesign:Card Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="ClipboardList" Width="48" Height="48" 
                                                               Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                                        <TextBlock x:Name="TotalTasksCount" Text="0" FontSize="32" FontWeight="Bold" 
                                                 HorizontalAlignment="Center"/>
                                        <TextBlock Text="Всего задач" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </materialDesign:Card>
                                
                                <materialDesign:Card Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="CheckCircle" Width="48" Height="48" 
                                                               Foreground="Green"/>
                                        <TextBlock x:Name="CompletedTasksCount" Text="0" FontSize="32" FontWeight="Bold" 
                                                 HorizontalAlignment="Center"/>
                                        <TextBlock Text="Завершено" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </materialDesign:Card>
                                
                                <materialDesign:Card Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="AlertCircle" Width="48" Height="48" 
                                                               Foreground="Orange"/>
                                        <TextBlock x:Name="OverdueTasksCount" Text="0" FontSize="32" FontWeight="Bold" 
                                                 HorizontalAlignment="Center"/>
                                        <TextBlock Text="Просрочено" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </materialDesign:Card>
                                
                                <materialDesign:Card Style="{StaticResource CardStyle}">
                                    <StackPanel>
                                        <materialDesign:PackIcon Kind="AccountGroup" Width="48" Height="48" 
                                                               Foreground="{DynamicResource SecondaryHueMidBrush}"/>
                                        <TextBlock x:Name="ActiveCrewsCount" Text="0" FontSize="32" FontWeight="Bold" 
                                                 HorizontalAlignment="Center"/>
                                        <TextBlock Text="Активных бригад" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </materialDesign:Card>
                            </UniformGrid>
                            
                            <!-- Последние отчёты -->
                            <materialDesign:Card Style="{StaticResource CardStyle}" Margin="0,16,0,0">
                                <StackPanel>
                                    <TextBlock Text="Последние отчёты" Style="{StaticResource SubHeaderTextStyle}"/>
                                    <DataGrid x:Name="RecentReportsGrid" AutoGenerateColumns="False" 
                                            CanUserAddRows="False" MaxHeight="300">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Задача" Binding="{Binding TaskTitle}" Width="*"/>
                                            <DataGridTextColumn Header="Автор" Binding="{Binding ReporterName}" Width="150"/>
                                            <DataGridTextColumn Header="Дата" Binding="{Binding ReportedAt, StringFormat=dd.MM.yyyy HH:mm}" Width="130"/>
                                            <DataGridTextColumn Header="Комментарий" Binding="{Binding ReportText}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </materialDesign:Card>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>

                <!-- Стройплощадки -->
                <Grid x:Name="SitesContent" Visibility="Collapsed">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="350"/>
                    </Grid.ColumnDefinitions>

                    <materialDesign:Card Style="{StaticResource CardStyle}" Grid.Column="0">
                        <StackPanel>
                            <TextBlock Text="Стройплощадки" Style="{StaticResource SubHeaderTextStyle}"/>
                            <DataGrid x:Name="dgSites" AutoGenerateColumns="False" IsReadOnly="True" 
                                    SelectionChanged="dgSites_SelectionChanged">
                        <DataGrid.Columns>
                                    <DataGridTextColumn Header="Название" Binding="{Binding SiteName}" Width="*"/>
                                    <DataGridTextColumn Header="Адрес" Binding="{Binding Address}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                        </StackPanel>
                    </materialDesign:Card>

                    <materialDesign:Card Style="{StaticResource CardStyle}" Grid.Column="1">
                        <StackPanel>
                            <TextBlock Text="Управление стройплощадкой" Style="{StaticResource SubHeaderTextStyle}"/>
                            
                            <TextBox x:Name="txtSiteName" 
                                   materialDesign:HintAssist.Hint="Название стройплощадки"
                                   Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                   Margin="0,0,0,16"/>
                            
                            <TextBox x:Name="txtSiteAddress" 
                                   materialDesign:HintAssist.Hint="Адрес"
                                   Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                   Margin="0,0,0,24"/>
                            
                            <ScrollViewer HorizontalScrollBarVisibility="Auto">
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="btnAddSite" Content="ДОБАВИТЬ" 
                                          Click="btnAddSite_Click" 
                                          Style="{StaticResource MaterialDesignRaisedButton}"
                                          Width="110"
                                          Margin="0,0,8,0"/>
                                    <Button x:Name="btnUpdateSite" Content="ОБНОВИТЬ" 
                                          Click="btnUpdateSite_Click" 
                                          Style="{StaticResource MaterialDesignOutlinedButton}"
                                          Width="110"
                                          Margin="0,0,8,0"/>
                                    <Button x:Name="btnDeleteSite" Content="УДАЛИТЬ" 
                                          Click="btnDeleteSite_Click" 
                                          Width="110"
                                          Style="{StaticResource MaterialDesignOutlinedButton}"/>
                        </StackPanel>
                            </ScrollViewer>
                    </StackPanel>
                    </materialDesign:Card>
                </Grid>

                <!-- Бригады -->
                <Grid x:Name="CrewsContent" Visibility="Collapsed">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="350"/>
                    </Grid.ColumnDefinitions>

                    <materialDesign:Card Style="{StaticResource CardStyle}" Grid.Column="0">
                        <StackPanel>
                            <TextBlock Text="Бригады" Style="{StaticResource SubHeaderTextStyle}"/>
                            <DataGrid x:Name="dgCrews" AutoGenerateColumns="False" IsReadOnly="True" 
                                    SelectionChanged="dgCrews_SelectionChanged">
                        <DataGrid.Columns>
                                    <DataGridTextColumn Header="Название бригады" Binding="{Binding CrewName}" Width="*"/>
                                    <DataGridTextColumn Header="Бригадир" Binding="{Binding Brigadier.Username}" Width="200"/>
                        </DataGrid.Columns>
                    </DataGrid>
                        </StackPanel>
                    </materialDesign:Card>

                    <materialDesign:Card Style="{StaticResource CardStyle}" Grid.Column="1">
                        <StackPanel>
                            <TextBlock Text="Управление бригадой" Style="{StaticResource SubHeaderTextStyle}"/>
                            
                            <TextBox x:Name="txtCrewName" 
                                   materialDesign:HintAssist.Hint="Название бригады"
                                   Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                   Margin="0,0,0,16"/>
                            
                            <ComboBox x:Name="cbBrigadiers" 
                                     materialDesign:HintAssist.Hint="Бригадир"
                                     Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                     DisplayMemberPath="Username"
                                     Margin="0,0,0,24"/>
                            
                            <ScrollViewer HorizontalScrollBarVisibility="Auto">
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="btnAddCrew" Content="ДОБАВИТЬ" 
                                          Click="btnAddCrew_Click" 
                                          Style="{StaticResource MaterialDesignRaisedButton}"
                                          Width="110"
                                          Margin="0,0,8,0"/>
                                    <Button x:Name="btnUpdateCrew" Content="ОБНОВИТЬ" 
                                          Click="btnUpdateCrew_Click" 
                                          Style="{StaticResource MaterialDesignOutlinedButton}"
                                          Width="110"
                                          Margin="0,0,8,0"/>
                                    <Button x:Name="btnDeleteCrew" Content="УДАЛИТЬ" 
                                          Click="btnDeleteCrew_Click" 
                                          Width="110"
                                          Style="{StaticResource MaterialDesignOutlinedButton}"/>
                        </StackPanel>
                            </ScrollViewer>
                    </StackPanel>
                    </materialDesign:Card>
                </Grid>

                <!-- Задачи -->
                <Grid x:Name="TasksContent" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Фильтры -->
                    <materialDesign:Card Style="{StaticResource CardStyle}" Grid.Row="0">
                        <StackPanel Orientation="Horizontal">
                            <ComboBox x:Name="cbSiteFilter" 
                                     materialDesign:HintAssist.Hint="Фильтр по объекту"
                                     Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                     DisplayMemberPath="SiteName" 
                                     Width="200" Margin="0,0,16,0"/>
                            <ComboBox x:Name="cbCrewFilter" 
                                     materialDesign:HintAssist.Hint="Фильтр по бригаде"
                                     Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                     DisplayMemberPath="CrewName" 
                                     Width="200" Margin="0,0,16,0"/>
                            <Button x:Name="btnFilterTasks" Content="ПРИМЕНИТЬ ФИЛЬТР" 
                                  Click="btnFilterTasks_Click" 
                                  Style="{StaticResource MaterialDesignRaisedButton}"
                                  Margin="0,0,16,0"/>
                            <Button x:Name="btnResetTaskFilter" Content="СБРОСИТЬ ФИЛЬТР" 
                                  Click="btnResetTaskFilter_Click" 
                                  Style="{StaticResource MaterialDesignOutlinedButton}"/>
                    </StackPanel>
                    </materialDesign:Card>

                    <!-- Список задач -->
                    <materialDesign:Card Style="{StaticResource CardStyle}" Grid.Row="1">
                        <StackPanel>
                            <TextBlock Text="Задачи" Style="{StaticResource SubHeaderTextStyle}"/>
                            <DataGrid x:Name="dgTasks" AutoGenerateColumns="False" IsReadOnly="True" 
                                    SelectionChanged="dgTasks_SelectionChanged">
                        <DataGrid.Columns>
                                    <DataGridTextColumn Header="Название" Binding="{Binding Title}" Width="*"/>
                                    <DataGridTextColumn Header="Объект" Binding="{Binding Site.SiteName}" Width="150"/>
                                    <DataGridTextColumn Header="Бригада" Binding="{Binding Crew.CrewName}" Width="150"/>
                                    <DataGridTextColumn Header="Приоритет" Binding="{Binding Priority.PriorityName}" Width="100"/>
                                    <DataGridTextColumn Header="Статус" Binding="{Binding TaskStatus.TaskStatusName}" Width="120"/>
                                    <DataGridTextColumn Header="Начало" Binding="{Binding StartDate, StringFormat=dd.MM.yyyy}" Width="100"/>
                                    <DataGridTextColumn Header="Окончание" Binding="{Binding EndDate, StringFormat=dd.MM.yyyy}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Управление задачами -->
                    <materialDesign:Card Style="{StaticResource CardStyle}" Grid.Row="2">
                                                <ScrollViewer HorizontalScrollBarVisibility="Auto">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Button x:Name="btnAddTask" Content="ДОБАВИТЬ ЗАДАЧУ" 
                                      Click="btnAddTask_Click" 
                                      Style="{StaticResource MaterialDesignRaisedButton}"
                                      Width="150"
                                      Margin="0,0,16,0"/>
                                <Button x:Name="btnUpdateTask" Content="РЕДАКТИРОВАТЬ" 
                                      Click="btnUpdateTask_Click" 
                                      Style="{StaticResource MaterialDesignOutlinedButton}"
                                      Width="150"
                                      Margin="0,0,16,0"/>
                                <Button x:Name="btnDeleteTask" Content="УДАЛИТЬ" 
                                      Click="btnDeleteTask_Click" 
                                      Style="{StaticResource MaterialDesignOutlinedButton}"
                                      Width="110"
                                      Margin="0,0,16,0"/>
                                <Button x:Name="btnUpdateStatus" Content="ИЗМЕНИТЬ СТАТУС" 
                                      Click="btnUpdateStatus_Click" 
                                      Width="150"
                                      Style="{StaticResource MaterialDesignRaisedButton}"/>
                            </StackPanel>
                        </ScrollViewer>
                    </materialDesign:Card>
                </Grid>

                <!-- Календарь -->
                <Grid x:Name="CalendarContent" Visibility="Collapsed">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Календарь и фильтры -->
                    <materialDesign:Card Style="{StaticResource CardStyle}" Grid.Column="0">
                        <StackPanel>
                            <TextBlock Text="Календарь задач" Style="{StaticResource SubHeaderTextStyle}"/>
                            
                            <Calendar x:Name="TaskCalendar" 
                                    SelectedDatesChanged="TaskCalendar_SelectedDatesChanged"
                                    Margin="0,16,0,16"/>
                            
                            <ComboBox x:Name="cbCalendarSiteFilter" 
                                     materialDesign:HintAssist.Hint="Фильтр по объекту"
                                     Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                     DisplayMemberPath="SiteName" 
                                     Margin="0,0,0,16"
                                     SelectionChanged="CalendarFilter_Changed"/>
                            
                            <ComboBox x:Name="cbCalendarCrewFilter" 
                                     materialDesign:HintAssist.Hint="Фильтр по бригаде"
                                     Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                                     DisplayMemberPath="CrewName" 
                                     Margin="0,0,0,16"
                                     SelectionChanged="CalendarFilter_Changed"/>
                            
                            <Button Content="СБРОСИТЬ ФИЛЬТРЫ" 
                                  Click="btnResetCalendarFilters_Click"
                                  Style="{StaticResource MaterialDesignOutlinedButton}"/>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Список задач на выбранную дату -->
                    <materialDesign:Card Style="{StaticResource CardStyle}" Grid.Column="1">
                        <StackPanel>
                            <TextBlock x:Name="SelectedDateText" Text="Выберите дату" 
                                     Style="{StaticResource SubHeaderTextStyle}"/>
                            
                            <DataGrid x:Name="dgCalendarTasks" AutoGenerateColumns="False" 
                                    CanUserAddRows="False" Margin="0,16,0,0">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Название" Binding="{Binding Title}" Width="*"/>
                                    <DataGridTextColumn Header="Объект" Binding="{Binding Site.SiteName}" Width="150"/>
                                    <DataGridTextColumn Header="Бригада" Binding="{Binding Crew.CrewName}" Width="150"/>
                                    <DataGridTextColumn Header="Статус" Binding="{Binding TaskStatus.TaskStatusName}" Width="120"/>
                                    <DataGridTextColumn Header="Приоритет" Binding="{Binding Priority.PriorityName}" Width="100"/>
                                    <DataGridTextColumn Header="Начало" Binding="{Binding StartDate, StringFormat=dd.MM.yyyy}" Width="100"/>
                                    <DataGridTextColumn Header="Окончание" Binding="{Binding EndDate, StringFormat=dd.MM.yyyy}" Width="100"/>
                                </DataGrid.Columns>
                            </DataGrid>
                    </StackPanel>
                    </materialDesign:Card>
                </Grid>

                                <!-- Отчёты -->
                <Grid x:Name="ReportsContent" Visibility="Collapsed">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Кнопки отчётов -->
                    <materialDesign:Card Style="{StaticResource CardStyle}" Grid.Row="0">
                        <StackPanel>
                            <TextBlock Text="Отчёты и аналитика" Style="{StaticResource SubHeaderTextStyle}"/>
                            
                            <StackPanel Orientation="Horizontal" Margin="0,16,0,0">
                                <Button x:Name="btnTasksBySite" Content="ЗАДАЧИ ПО ОБЪЕКТАМ" 
                                      Click="btnTasksBySite_Click" 
                                      Style="{StaticResource MaterialDesignRaisedButton}"
                                      Margin="0,0,16,0"/>
                                <Button x:Name="btnTasksByCrew" Content="ВЫПОЛНЕНИЕ ПО БРИГАДАМ" 
                                      Click="btnTasksByCrew_Click" 
                                      Style="{StaticResource MaterialDesignRaisedButton}"
                                      Margin="0,0,16,0"/>
                                <Button x:Name="btnOverdueTasks" Content="ПРОСРОЧЕННЫЕ ЗАДАЧИ" 
                                      Click="btnOverdueTasks_Click" 
                                      Style="{StaticResource MaterialDesignRaisedButton}"
                                      Margin="0,0,16,0"/>
                    </StackPanel>

                            <Separator Margin="0,16"/>
                            
                            <TextBlock Text="Экспорт данных" Style="{StaticResource SubHeaderTextStyle}"/>
                            <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                <Button Click="ExportCsv_Click" 
                                      Style="{StaticResource MaterialDesignOutlinedButton}"
                                      Margin="0,0,16,0">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="FileDelimited" Margin="0,0,8,0"/>
                                        <TextBlock Text="CSV"/>
                                    </StackPanel>
                                </Button>
                                <Button Click="ExportExcel_Click" 
                                      Style="{StaticResource MaterialDesignOutlinedButton}"
                                      Margin="0,0,16,0">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="MicrosoftExcel" Margin="0,0,8,0"/>
                                        <TextBlock Text="EXCEL"/>
                                    </StackPanel>
                                </Button>
                                <Button Click="ExportPdf_Click" 
                                      Style="{StaticResource MaterialDesignOutlinedButton}">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="FileDocument" Margin="0,0,8,0"/>
                                        <TextBlock Text="PDF"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Результаты отчётов -->
                    <materialDesign:Card Style="{StaticResource CardStyle}" Grid.Row="1">
                        <StackPanel>
                            <TextBlock x:Name="ReportTitle" Text="Выберите тип отчёта" 
                                     Style="{StaticResource SubHeaderTextStyle}"/>
                            <DataGrid x:Name="dgReports" AutoGenerateColumns="True" 
                                    CanUserAddRows="False" Margin="0,16,0,0"/>
                        </StackPanel>
                    </materialDesign:Card>
                </Grid>

                <!-- Журнал отчётов -->
                <Grid x:Name="JournalContent" Visibility="Collapsed">
                    <materialDesign:Card Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Журнал отчётов по задачам" Style="{StaticResource SubHeaderTextStyle}"/>
                            <DataGrid x:Name="dgTaskReports" AutoGenerateColumns="False" 
                                    CanUserAddRows="False" Margin="0,16,0,0">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Задача" Binding="{Binding TaskTitle}" Width="*"/>
                                    <DataGridTextColumn Header="Автор" Binding="{Binding ReporterName}" Width="150"/>
                                    <DataGridTextColumn Header="Дата" Binding="{Binding ReportedAt, StringFormat=dd.MM.yyyy HH:mm}" Width="130"/>
                                    <DataGridTextColumn Header="Прогресс %" Binding="{Binding ProgressPercent}" Width="100"/>
                                    <DataGridTextColumn Header="Комментарий" Binding="{Binding ReportText}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </materialDesign:Card>
                </Grid>
    </Grid>
        </DockPanel>
    </materialDesign:DrawerHost>
</Window>